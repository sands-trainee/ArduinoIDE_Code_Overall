#include <Arduino.h>
#include <IRremoteESP8266.h>
#include <IRsend.h>
#include <IRrecv.h>
#include <IRutils.h>
#include <WiFi.h>
#include <PubSubClient.h>
#include <OneWire.h>
#include <DallasTemperature.h>

// Wi-Fi credentials
#define WIFI_STA_NAME "wirelessguru"
#define WIFI_STA_PASS "guru54510250"

// MQTT broker details
#define MQTT_SERVER "test.mosquitto.org"
#define MQTT_PORT 1883
#define MQTT_NAME "AirTest"

// Define the GPIO pins for IR LED and IR receiver
const uint16_t kIrLed = 4;    // GPIO pin number for IR LED
const uint16_t kIrRecv = 14;  // GPIO pin number for IR receiver

IRsend irsend(kIrLed);
IRrecv irrecv(kIrRecv);
decode_results results;

// Raw data arrays for different IR commands
uint16_t rawDataon[229] = {3080, 2966,  3082, 4428,  554, 1634,  580, 538,  556, 1634,  554, 566,  556, 564,  556, 1658,  552, 1636,  532, 564,  578, 1636,  530, 566,  576, 542,  556, 1658,  532, 564,  558, 564,  556, 1652,  560, 538,  556, 1634,  556, 1656,  532, 1636,  554, 564,  556, 564,  558, 564,  578, 540,  556, 564,  556, 566,  556, 564,  556, 564,  556, 564,  580, 540,  554, 564,  558, 564,  578, 540,  556, 566,  556, 1656,  556, 540,  554, 566,  556, 564,  556, 564,  556, 566,  556, 562,  580, 542,  580, 536,  558, 1634,  556, 564,  556, 564,  556, 564,  556, 564,  556, 564,  556, 564,  580, 540,  580, 540,  580, 538,  558, 564,  578, 542,  558, 562,  556, 566,  556, 564,  556, 564,  558, 1656,  554, 542,  556, 564,  580, 542,  554, 566,  578, 540,  554, 566,  556, 564,  556, 564,  558, 562,  558, 564,  580, 538,  556, 564,  558, 564,  556, 564,  556, 564,  556, 564,  580, 542,  556, 564,  556, 564,  580, 542,  578, 540,  556, 566,  580, 538,  558, 566,  552, 564,  556, 564,  556, 564,  556, 564,  556, 566,  554, 564,  556, 564,  556, 564,  554, 566,  580, 540,  554, 564,  582, 538,  556, 564,  558, 564,  554, 566,  578, 544,  554, 564,  582, 540,  554, 1636,  554, 564,  556, 1634,  578, 1614,  576, 538,  558, 564,  580, 1612,  554, 1634,  578, 1610,  580, 538,  582, 1610,  556};
uint16_t rawDataoff[229] = {3080, 2966,  3082, 4424,  582, 1610,  580, 540,  580, 1612,  576, 542,  580, 538,  580, 1612,  578, 1612,  578, 542,  578, 1612,  554, 564,  578, 542,  556, 1636,  578, 542,  578, 540,  580, 540,  578, 542,  580, 1612,  576, 1614,  576, 1610,  580, 538,  580, 540,  580, 542,  578, 542,  556, 564,  556, 564,  556, 564,  556, 564,  556, 564,  556, 566,  554, 564,  556, 564,  556, 566,  556, 564,  580, 540,  578, 544,  554, 566,  554, 566,  554, 564,  580, 540,  556, 566,  554, 566,  554, 566,  556, 1636,  574, 542,  556, 564,  580, 540,  558, 564,  578, 540,  582, 538,  580, 542,  580, 540,  580, 540,  580, 542,  578, 538,  582, 540,  580, 538,  582, 540,  580, 540,  580, 1636,  554, 540,  580, 540,  578, 542,  580, 540,  580, 542,  578, 540,  580, 540,  580, 540,  580, 540,  580, 542,  582, 538,  580, 540,  580, 540,  578, 540,  580, 542,  580, 542,  578, 540,  580, 540,  580, 538,  582, 540,  580, 540,  580, 540,  580, 542,  578, 540,  582, 540,  578, 542,  578, 542,  580, 540,  580, 540,  582, 540,  578, 540,  582, 538,  580, 540,  580, 540,  580, 540,  580, 540,  580, 540,  582, 540,  580, 540,  580, 540,  582, 542,  578, 540,  580, 1614,  576, 540,  580, 1612,  576, 542,  580, 1614,  576, 540,  578, 1614,  576, 1612,  576, 540,  580, 1610,  580, 1612,  576};
uint16_t rawData16[229] = {3082, 2964,  3062, 4450,  582, 1608,  580, 542,  580, 1608,  582, 540,  580, 538,  556, 1634,  580, 1612,  580, 540,  580, 538,  584, 538,  580, 542,  580, 540,  580, 542,  580, 538,  582, 1610,  582, 538,  558, 1632,  580, 1610,  580, 1610,  582, 538,  582, 540,  578, 540,  582, 538,  582, 542,  578, 542,  578, 542,  584, 538,  582, 538,  582, 538,  580, 542,  580, 540,  580, 540,  582, 538,  582, 1608,  580, 540,  580, 538,  582, 542,  580, 538,  582, 538,  584, 536,  582, 540,  580, 542,  580, 1606,  582, 540,  580, 538,  582, 540,  580, 540,  582, 538,  582, 538,  580, 540,  582, 540,  582, 538,  582, 538,  582, 540,  580, 538,  582, 536,  584, 540,  582, 538,  578, 1610,  580, 540,  582, 540,  582, 538,  582, 538,  580, 540,  582, 538,  584, 538,  582, 544,  576, 544,  578, 542,  578, 542,  580, 542,  556, 564,  578, 540,  582, 542,  578, 540,  582, 540,  580, 542,  582, 540,  556, 564,  578, 542,  582, 538,  558, 562,  584, 540,  578, 542,  580, 540,  580, 538,  584, 540,  580, 540,  578, 542,  554, 566,  578, 542,  582, 538,  582, 538,  580, 542,  582, 538,  580, 542,  582, 538,  582, 538,  582, 540,  582, 538,  584, 538,  578, 540,  582, 536,  586, 1608,  582, 536,  582, 538,  584, 538,  582, 538,  582, 1606,  582, 538,  584, 538,  582, 1606,  584};  // HAIER_AC_YRW02
uint16_t rawData17[229] = {3086, 2960,  3088, 4422,  582, 1608,  584, 538,  582, 1608,  584, 534,  584, 542,  580, 1608,  582, 1608,  580, 540,  582, 538,  582, 538,  584, 536,  584, 1608,  582, 536,  584, 538,  582, 1606,  584, 536,  582, 1610,  608, 1580,  584, 1610,  582, 536,  584, 538,  582, 538,  584, 538,  582, 538,  582, 538,  584, 538,  582, 538,  582, 538,  582, 540,  580, 540,  582, 540,  580, 540,  580, 536,  584, 1608,  584, 536,  608, 514,  582, 540,  582, 538,  584, 536,  584, 536,  582, 540,  580, 540,  582, 1608,  582, 538,  582, 540,  578, 540,  584, 538,  582, 540,  578, 542,  578, 540,  584, 538,  580, 542,  582, 536,  582, 536,  584, 540,  578, 540,  580, 538,  582, 542,  582, 1608,  580, 540,  582, 538,  580, 540,  580, 540,  582, 538,  582, 538,  582, 538,  582, 538,  584, 538,  582, 538,  584, 534,  582, 540,  582, 538,  584, 538,  582, 538,  582, 538,  582, 540,  582, 538,  582, 538,  582, 538,  580, 538,  582, 540,  580, 538,  582, 538,  582, 538,  586, 536,  582, 536,  584, 534,  584, 538,  582, 540,  582, 540,  582, 538,  584, 536,  582, 538,  584, 534,  584, 538,  582, 538,  584, 538,  580, 540,  584, 536,  582, 538,  582, 538,  582, 540,  580, 538,  582, 1608,  582, 540,  580, 538,  584, 538,  582, 1606,  582, 1608,  582, 538,  582, 536,  584, 1608,  582}; 
uint16_t rawData18[229] = {3082, 2966,  3084, 4424,  580, 1612,  556, 566,  582, 1606,  582, 538,  584, 538,  578, 1610,  582, 1610,  580, 540,  582, 538,  582, 540,  580, 1610,  556, 566,  580, 538,  580, 542,  582, 1608,  576, 542,  582, 1610,  582, 1610,  580, 1610,  582, 538,  578, 544,  580, 540,  580, 540,  580, 542,  580, 538,  582, 540,  580, 542,  580, 542,  580, 538,  578, 566,  556, 540,  578, 542,  580, 540,  580, 1610,  578, 540,  580, 542,  578, 540,  578, 544,  578, 542,  578, 542,  582, 540,  582, 540,  580, 1610,  556, 564,  580, 538,  560, 564,  554, 564,  582, 538,  584, 542,  578, 540,  584, 534,  584, 538,  580, 540,  556, 564,  582, 538,  582, 542,  580, 538,  580, 542,  578, 1610,  580, 538,  584, 540,  578, 542,  578, 540,  582, 540,  580, 540,  584, 538,  582, 538,  582, 538,  582, 542,  580, 538,  580, 542,  580, 538,  582, 540,  578, 542,  578, 540,  582, 540,  584, 538,  580, 542,  578, 540,  582, 540,  582, 538,  584, 538,  580, 538,  580, 542,  580, 540,  582, 538,  580, 538,  580, 542,  580, 540,  584, 536,  582, 538,  580, 542,  580, 538,  580, 538,  560, 562,  580, 542,  580, 540,  580, 540,  582, 538,  582, 542,  578, 538,  582, 542,  580, 536,  582, 1608,  582, 538,  580, 542,  578, 1612,  576, 540,  582, 1610,  582, 540,  582, 538,  580, 1632,  556};
uint16_t rawData19[229] = {3080, 2968,  3084, 4424,  580, 1634,  558, 538,  580, 1636,  530, 564,  578, 542,  580, 1614,  576, 1634,  554, 540,  580, 542,  578, 542,  576, 1614,  578, 1636,  556, 542,  576, 544,  574, 1638,  556, 538,  580, 1612,  578, 1634,  556, 1612,  578, 540,  580, 542,  578, 540,  580, 542,  578, 542,  580, 542,  578, 542,  578, 540,  578, 542,  580, 542,  580, 540,  580, 538,  580, 542,  578, 542,  580, 1634,  556, 540,  582, 540,  578, 544,  576, 544,  580, 540,  580, 542,  580, 542,  578, 544,  578, 1634,  556, 540,  580, 538,  582, 540,  578, 542,  578, 542,  580, 540,  578, 540,  580, 542,  580, 540,  580, 540,  580, 542,  578, 542,  578, 542,  554, 566,  554, 566,  580, 1634,  556, 542,  578, 542,  578, 542,  580, 542,  578, 542,  580, 540,  580, 540,  580, 542,  578, 542,  578, 542,  578, 544,  578, 540,  580, 542,  578, 542,  576, 542,  580, 542,  576, 544,  578, 542,  578, 544,  576, 544,  580, 540,  580, 542,  578, 540,  580, 542,  580, 542,  580, 540,  580, 540,  582, 540,  556, 564,  556, 568,  576, 542,  580, 540,  578, 544,  554, 566,  556, 564,  578, 544,  554, 568,  554, 566,  578, 540,  578, 542,  580, 540,  556, 566,  578, 542,  580, 542,  556, 1634,  554, 566,  556, 564,  578, 1636,  552, 1638,  556, 1610,  576, 542,  580, 540,  558, 1658,  554};
uint16_t rawData20[229] = {3082, 2966,  3086, 4424,  580, 1608,  582, 542,  578, 1612,  578, 540,  582, 540,  578, 1610,  580, 1610,  582, 538,  580, 540,  580, 1610,  582, 540,  580, 538,  582, 540,  580, 540,  580, 1610,  580, 540,  582, 1610,  578, 1610,  580, 1610,  582, 538,  580, 542,  578, 540,  582, 538,  582, 540,  582, 542,  578, 540,  582, 538,  580, 542,  582, 538,  580, 540,  580, 540,  580, 542,  582, 538,  580, 1610,  582, 538,  580, 542,  580, 540,  582, 540,  580, 540,  580, 542,  580, 540,  580, 540,  580, 1610,  580, 540,  580, 540,  580, 540,  580, 542,  578, 540,  582, 540,  580, 540,  580, 540,  582, 540,  580, 542,  578, 540,  580, 542,  580, 540,  580, 540,  582, 540,  580, 1610,  580, 538,  584, 536,  582, 540,  582, 538,  582, 540,  580, 542,  580, 540,  580, 542,  580, 540,  580, 540,  582, 538,  580, 540,  582, 540,  578, 544,  576, 542,  580, 542,  578, 540,  580, 540,  580, 540,  580, 540,  582, 538,  582, 540,  578, 542,  580, 540,  582, 540,  582, 538,  580, 540,  580, 542,  580, 540,  580, 540,  582, 540,  580, 542,  580, 540,  580, 540,  582, 540,  580, 538,  580, 542,  578, 540,  582, 540,  580, 542,  580, 540,  580, 540,  580, 540,  580, 542,  580, 1608,  580, 542,  580, 1608,  582, 542,  580, 540,  580, 1610,  580, 540,  582, 540,  578, 1610,  578};
uint16_t rawData21[229] = {3084, 2962,  3088, 4424,  582, 1608,  580, 538,  584, 1608,  580, 538,  582, 538,  582, 1608,  584, 1608,  582, 540,  580, 540,  582, 1608,  582, 538,  582, 1610,  578, 542,  582, 538,  582, 1608,  584, 538,  582, 1608,  582, 1608,  582, 1606,  584, 536,  584, 538,  582, 538,  584, 538,  580, 540,  580, 536,  584, 538,  582, 540,  582, 538,  582, 538,  582, 540,  582, 540,  578, 540,  582, 540,  584, 1606,  582, 538,  584, 536,  584, 538,  582, 538,  558, 564,  582, 538,  584, 538,  582, 538,  582, 1606,  584, 538,  584, 536,  584, 538,  584, 538,  582, 538,  582, 540,  582, 538,  580, 540,  582, 540,  582, 540,  580, 540,  582, 538,  580, 540,  582, 540,  582, 540,  584, 1608,  580, 538,  582, 540,  580, 538,  582, 538,  584, 538,  582, 538,  582, 538,  584, 538,  580, 540,  578, 542,  580, 538,  608, 512,  582, 538,  582, 538,  582, 540,  582, 538,  584, 538,  582, 540,  582, 538,  582, 538,  582, 540,  580, 540,  582, 538,  580, 542,  578, 542,  580, 540,  582, 538,  582, 540,  582, 538,  582, 538,  582, 540,  580, 538,  580, 542,  580, 538,  582, 540,  580, 540,  582, 538,  584, 538,  580, 538,  584, 538,  582, 538,  580, 538,  582, 540,  582, 538,  582, 1610,  578, 540,  580, 1610,  582, 540,  580, 1608,  582, 1608,  582, 538,  582, 540,  580, 1608,  582};  // HAIER_AC_YRW02
uint16_t rawData22[229] = {3080, 2964,  3084, 4426,  580, 1608,  582, 540,  580, 1608,  582, 542,  578, 540,  582, 1608,  582, 1608,  582, 538,  582, 538,  580, 1608,  582, 1610,  582, 538,  580, 540,  580, 538,  582, 1608,  580, 540,  582, 1610,  578, 1610,  580, 1608,  582, 540,  582, 538,  582, 538,  582, 538,  584, 536,  582, 540,  580, 538,  580, 542,  578, 540,  582, 538,  582, 538,  584, 538,  582, 540,  580, 540,  582, 1608,  580, 538,  584, 538,  582, 536,  584, 538,  582, 540,  580, 540,  582, 540,  582, 538,  582, 1606,  582, 538,  582, 540,  578, 542,  580, 538,  582, 540,  582, 538,  582, 538,  580, 540,  582, 540,  582, 538,  582, 538,  580, 540,  580, 542,  582, 538,  582, 538,  582, 1610,  580, 540,  582, 538,  582, 538,  582, 538,  580, 542,  578, 542,  580, 538,  582, 540,  580, 540,  582, 538,  582, 540,  582, 538,  582, 540,  580, 540,  580, 538,  582, 540,  580, 540,  580, 538,  582, 540,  582, 538,  582, 538,  582, 540,  580, 540,  582, 540,  580, 540,  580, 538,  580, 540,  582, 540,  580, 538,  580, 542,  580, 540,  582, 538,  580, 540,  580, 538,  582, 540,  582, 540,  580, 540,  580, 540,  580, 542,  580, 540,  580, 540,  582, 538,  582, 540,  580, 540,  582, 1608,  580, 540,  582, 1608,  582, 1610,  580, 538,  582, 1608,  580, 542,  580, 540,  582, 1610,  580};  // HAIER_AC_YRW02
uint16_t rawData23[229] = {3082, 2966,  3082, 4426,  584, 1608,  582, 540,  582, 1608,  582, 538,  582, 538,  582, 1608,  582, 1606,  584, 538,  582, 538,  582, 1608,  582, 1608,  582, 1608,  580, 540,  582, 538,  582, 1608,  584, 538,  582, 1606,  584, 1606,  582, 1608,  584, 538,  582, 538,  580, 540,  580, 540,  580, 538,  580, 540,  582, 538,  580, 540,  582, 540,  578, 540,  584, 538,  582, 538,  580, 542,  580, 538,  582, 1608,  582, 538,  580, 542,  578, 540,  580, 540,  582, 538,  580, 540,  580, 540,  580, 542,  578, 1610,  582, 540,  580, 542,  578, 540,  580, 540,  580, 544,  578, 540,  578, 542,  578, 542,  580, 542,  578, 540,  582, 540,  580, 540,  580, 540,  580, 542,  578, 542,  580, 1610,  578, 540,  582, 540,  580, 540,  580, 540,  578, 542,  580, 542,  578, 542,  580, 540,  580, 544,  578, 540,  580, 540,  580, 540,  582, 538,  580, 540,  580, 540,  580, 542,  580, 542,  580, 540,  582, 538,  580, 540,  578, 540,  580, 540,  580, 540,  580, 542,  578, 540,  580, 540,  582, 540,  580, 540,  582, 538,  580, 542,  578, 542,  580, 540,  578, 542,  580, 540,  580, 540,  580, 542,  578, 540,  580, 540,  580, 540,  580, 540,  582, 538,  582, 540,  580, 540,  582, 540,  580, 1608,  582, 540,  580, 1610,  580, 1612,  578, 1610,  582, 1608,  580, 540,  580, 540,  580, 1610,  580}; 
uint16_t rawData24[229] = {3084, 2962,  3088, 4422,  582, 1608,  582, 538,  582, 1606,  582, 542,  580, 540,  580, 1608,  582, 1608,  582, 540,  582, 1606,  582, 538,  582, 540,  580, 540,  582, 540,  582, 540,  580, 1608,  582, 538,  580, 1610,  584, 1608,  582, 1608,  580, 544,  580, 540,  582, 538,  580, 540,  584, 538,  580, 540,  580, 538,  582, 538,  584, 538,  582, 540,  580, 540,  580, 540,  582, 540,  580, 540,  580, 1608,  582, 542,  580, 538,  580, 540,  582, 536,  584, 538,  580, 538,  584, 538,  608, 512,  584, 1606,  580, 538,  584, 536,  584, 536,  586, 536,  582, 538,  582, 538,  584, 536,  582, 540,  582, 538,  584, 536,  584, 538,  580, 538,  584, 538,  580, 540,  582, 538,  582, 1606,  582, 538,  582, 538,  584, 536,  582, 540,  582, 538,  582, 538,  582, 538,  580, 538,  584, 538,  582, 538,  580, 542,  580, 538,  584, 536,  584, 536,  584, 538,  582, 538,  582, 538,  606, 514,  582, 538,  584, 536,  584, 536,  584, 538,  584, 536,  584, 536,  584, 538,  584, 536,  584, 538,  586, 536,  582, 538,  584, 538,  588, 532,  582, 540,  582, 538,  584, 534,  584, 536,  582, 540,  582, 538,  584, 538,  582, 538,  582, 538,  584, 536,  582, 538,  582, 540,  582, 540,  584, 1606,  582, 1606,  584, 538,  584, 536,  582, 538,  584, 1606,  582, 538,  584, 534,  582, 1610,  608};  
uint16_t rawData25[229] = {3092, 2978,  3096, 4444,  582, 1620,  580, 544,  582, 1618,  580, 542,  582, 542,  582, 1618,  580, 1622,  578, 542,  582, 1644,  556, 544,  580, 542,  584, 1620,  580, 1618,  582, 1642,  556, 542,  584, 544,  580, 544,  582, 1620,  580, 1618,  582, 542,  582, 542,  582, 544,  582, 542,  582, 544,  582, 542,  582, 542,  582, 544,  582, 544,  582, 544,  582, 544,  580, 544,  582, 544,  582, 544,  582, 1620,  580, 542,  584, 540,  582, 544,  582, 542,  582, 542,  582, 544,  580, 544,  582, 542,  582, 1618,  580, 544,  582, 542,  580, 544,  582, 544,  580, 544,  582, 544,  582, 1616,  584, 542,  584, 542,  584, 542,  582, 542,  582, 542,  582, 542,  582, 544,  580, 544,  580, 1622,  578, 542,  584, 542,  582, 542,  582, 542,  582, 542,  582, 544,  580, 542,  582, 544,  582, 544,  580, 544,  582, 542,  582, 544,  582, 544,  582, 542,  584, 542,  584, 544,  582, 544,  582, 544,  582, 542,  582, 544,  582, 544,  580, 542,  582, 542,  584, 542,  582, 544,  582, 544,  582, 542,  582, 542,  584, 542,  582, 546,  580, 542,  582, 544,  582, 544,  582, 542,  584, 542,  582, 542,  582, 544,  582, 542,  582, 542,  582, 544,  582, 544,  580, 544,  580, 544,  582, 544,  582, 544,  582, 544,  582, 1620,  578, 1620,  578, 544,  582, 544,  580, 544,  582, 1622,  578, 542,  582};
uint16_t rawData26[229] = {3084, 2962,  3088, 4422,  584, 1606,  582, 538,  584, 1604,  584, 538,  584, 540,  582, 1606,  582, 1608,  582, 538,  582, 1608,  582, 536,  584, 1608,  582, 540,  580, 538,  582, 540,  578, 1612,  582, 540,  580, 1610,  578, 1634,  558, 1632,  556, 540,  582, 538,  582, 538,  582, 540,  580, 540,  582, 540,  580, 540,  582, 540,  582, 538,  582, 540,  582, 538,  582, 540,  580, 538,  580, 542,  580, 1610,  580, 540,  580, 540,  582, 540,  582, 538,  582, 538,  582, 540,  580, 540,  580, 542,  578, 1634,  556, 542,  578, 542,  580, 540,  582, 538,  580, 540,  584, 540,  580, 538,  580, 538,  582, 540,  580, 540,  578, 540,  582, 542,  578, 540,  580, 540,  582, 540,  580, 1632,  560, 536,  584, 538,  582, 538,  582, 540,  580, 538,  582, 538,  582, 538,  582, 540,  582, 540,  580, 542,  580, 540,  580, 540,  578, 540,  580, 542,  582, 536,  584, 538,  580, 540,  582, 540,  582, 542,  578, 540,  580, 540,  580, 540,  584, 538,  580, 538,  584, 540,  578, 540,  582, 538,  582, 540,  582, 540,  580, 540,  580, 538,  580, 540,  582, 540,  580, 538,  584, 538,  558, 564,  580, 540,  582, 540,  578, 542,  580, 540,  582, 540,  578, 542,  578, 542,  582, 538,  584, 538,  580, 1632,  558, 540,  582, 1610,  580, 540,  582, 1608,  578, 542,  582, 538,  606, 514,  582};  // HAIER_AC_YRW02
uint16_t rawData27[229] = {3078, 2968,  3082, 4428,  578, 1636,  556, 540,  580, 1612,  578, 542,  578, 542,  580, 1636,  552, 1614,  576, 542,  580, 1612,  576, 542,  578, 1612,  578, 1636,  554, 542,  578, 542,  580, 1634,  554, 542,  580, 1614,  576, 1636,  552, 1612,  578, 540,  580, 542,  580, 540,  578, 542,  578, 542,  580, 542,  580, 542,  580, 540,  580, 540,  580, 540,  580, 540,  580, 542,  578, 540,  580, 542,  580, 1636,  556, 542,  578, 542,  580, 538,  580, 542,  578, 542,  580, 542,  578, 542,  578, 542,  580, 1612,  578, 542,  578, 542,  580, 540,  580, 542,  578, 542,  580, 542,  578, 540,  582, 540,  578, 540,  580, 540,  582, 540,  578, 542,  578, 542,  580, 542,  578, 542,  580, 1636,  554, 540,  580, 540,  580, 540,  580, 540,  580, 542,  580, 540,  580, 540,  580, 540,  578, 542,  578, 542,  580, 540,  580, 542,  578, 542,  580, 540,  580, 540,  580, 540,  582, 538,  582, 540,  580, 540,  578, 542,  580, 540,  580, 542,  578, 542,  580, 540,  578, 542,  580, 540,  578, 542,  578, 542,  582, 540,  578, 540,  582, 540,  580, 542,  578, 542,  580, 538,  582, 540,  582, 540,  580, 542,  580, 538,  582, 540,  582, 540,  578, 542,  578, 542,  580, 540,  578, 542,  582, 538,  580, 1636,  554, 542,  578, 1612,  578, 1636,  552, 1614,  576, 542,  580, 542,  578, 540,  578};  // HAIER_AC_YRW02
uint16_t rawData28[229] = {3078, 2968,  3082, 4426,  580, 1634,  554, 544,  580, 1634,  556, 540,  578, 544,  578, 1610,  580, 1634,  554, 544,  576, 1636,  554, 1634,  556, 542,  578, 542,  578, 544,  578, 540,  580, 1636,  556, 540,  580, 1634,  556, 1634,  556, 1634,  554, 542,  580, 542,  578, 542,  578, 544,  578, 542,  578, 542,  580, 540,  580, 540,  580, 542,  578, 544,  580, 540,  578, 542,  578, 542,  580, 542,  578, 1636,  554, 542,  578, 544,  578, 542,  578, 542,  580, 542,  578, 544,  576, 544,  578, 540,  580, 1636,  556, 540,  556, 564,  580, 542,  578, 542,  578, 542,  580, 542,  556, 566,  580, 540,  580, 542,  578, 540,  578, 546,  556, 564,  578, 542,  580, 544,  576, 542,  580, 1636,  554, 540,  580, 540,  556, 566,  554, 566,  576, 544,  578, 542,  554, 566,  556, 564,  554, 566,  556, 564,  578, 542,  578, 542,  554, 566,  578, 542,  578, 542,  556, 564,  578, 542,  580, 540,  578, 544,  578, 542,  556, 566,  576, 544,  578, 542,  578, 542,  556, 566,  556, 564,  580, 542,  556, 566,  580, 542,  552, 566,  556, 564,  566, 556,  576, 544,  578, 542,  556, 566,  576, 542,  580, 542,  554, 566,  556, 564,  556, 566,  556, 564,  556, 566,  576, 544,  578, 542,  578, 544,  556, 1658,  552, 1638,  528, 566,  554, 566,  556, 1660,  530, 564,  556, 566,  556, 564,  554};  // HAIER_AC_YRW02
uint16_t rawData29[229] = {3058, 2990,  3060, 4452,  556, 1634,  554, 566,  554, 1636,  578, 540,  556, 566,  554, 1638,  554, 1658,  530, 566,  554, 1660,  530, 1658,  556, 542,  556, 1658,  532, 566,  572, 550,  572, 1618,  554, 564,  580, 1634,  530, 1660,  530, 1660,  532, 564,  580, 542,  578, 542,  554, 566,  554, 566,  556, 564,  578, 544,  554, 566,  554, 564,  556, 566,  578, 542,  578, 542,  578, 542,  556, 564,  556, 1636,  554, 564,  556, 566,  554, 566,  554, 564,  558, 564,  554, 568,  578, 542,  578, 540,  578, 1636,  532, 564,  556, 564,  558, 564,  556, 564,  554, 566,  556, 566,  578, 542,  554, 568,  578, 542,  554, 566,  554, 564,  556, 566,  556, 564,  556, 566,  578, 542,  578, 1636,  532, 564,  556, 564,  556, 568,  576, 542,  582, 542,  554, 566,  576, 542,  580, 542,  554, 566,  578, 542,  578, 542,  556, 566,  556, 564,  556, 566,  556, 564,  580, 542,  554, 566,  578, 542,  554, 564,  556, 566,  554, 566,  556, 566,  552, 566,  580, 542,  556, 566,  556, 564,  556, 564,  558, 564,  580, 542,  580, 540,  556, 566,  556, 564,  578, 542,  580, 538,  558, 564,  558, 564,  556, 564,  580, 542,  578, 540,  582, 540,  556, 566,  578, 542,  556, 564,  580, 540,  578, 542,  554, 1660,  556, 1632,  556, 540,  580, 1634,  556, 1636,  536, 562,  580, 540,  582, 538,  582};  // HAIER_AC_YRW02
uint16_t rawData30[229] = {3082, 2964,  3082, 4426,  582, 1610,  578, 542,  578, 1614,  578, 540,  582, 538,  582, 1632,  558, 1608,  578, 542,  580, 1634,  554, 1636,  556, 1612,  580, 540,  580, 540,  578, 544,  578, 1610,  580, 536,  584, 1610,  578, 1634,  556, 1632,  556, 542,  580, 538,  584, 538,  580, 540,  582, 538,  580, 542,  580, 542,  578, 540,  580, 540,  582, 536,  584, 536,  582, 542,  582, 536,  582, 540,  580, 1608,  580, 542,  582, 540,  580, 542,  578, 542,  580, 540,  580, 540,  554, 566,  580, 540,  580, 1612,  578, 540,  578, 542,  580, 540,  582, 538,  582, 538,  582, 538,  582, 540,  556, 564,  578, 542,  558, 564,  580, 542,  578, 542,  580, 538,  582, 538,  580, 542,  558, 1630,  580, 542,  556, 564,  580, 542,  580, 542,  582, 538,  582, 540,  578, 540,  558, 566,  578, 540,  578, 544,  580, 540,  580, 540,  582, 540,  578, 540,  558, 564,  580, 540,  580, 542,  578, 542,  580, 542,  554, 566,  580, 538,  580, 544,  578, 542,  580, 540,  580, 540,  582, 538,  580, 540,  582, 540,  570, 550,  580, 542,  578, 540,  582, 542,  556, 562,  580, 540,  580, 542,  578, 542,  582, 542,  578, 542,  578, 540,  578, 542,  580, 538,  584, 538,  582, 540,  578, 540,  582, 540,  578, 1610,  580, 1612,  580, 1608,  580, 538,  580, 1612,  580, 538,  582, 540,  554, 566,  582};

// MQTT client
WiFiClient espClient;
PubSubClient client(espClient);

// OneWire and DallasTemperature setup
#define ONE_WIRE_BUS 8
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensors(&oneWire);

float Celsius = 0;
float Fahrenheit = 0;

void setup_wifi();
void callback(char* topic, byte* payload, unsigned int length);
void reconnect();

void setup() {
  Serial.begin(115200);
  irsend.begin();
  irrecv.enableIRIn(); // Start the receiver

  // Initialize temperature sensor
  sensors.begin();

  // Setup Wi-Fi and MQTT
  setup_wifi();
  client.setServer(MQTT_SERVER, MQTT_PORT);
  client.setCallback(callback);
}

void loop() {
  // Ensure MQTT connection
  if (!client.connected()) {
    reconnect();
  }
  client.loop();

  // Check if IR data has been received
  if (irrecv.decode(&results)) {
    // Print the received data to the serial monitor
    Serial.println("IR signal received:");
    Serial.println(results.value, HEX); // Print the decoded IR signal value in hexadecimal

    // Print the raw data
    Serial.print("Received IR signal with raw data: ");
    for (uint16_t i = 0; i < results.rawlen; i++) {
      Serial.print(results.rawbuf[i] * kRawTick); // Convert to microseconds
      if (i < results.rawlen - 1) {
        Serial.print(", ");
      }
    }
    Serial.println("");

    irrecv.resume();  // Receive the next value
  }

  // Request and print temperature
  sensors.requestTemperatures();
  Celsius = sensors.getTempCByIndex(0);
  Fahrenheit = sensors.toFahrenheit(Celsius);

  Serial.print(Celsius);
  Serial.print(" C  ");
  Serial.print(Fahrenheit);
  Serial.println(" F");

  delay(1000); // Adjust delay as needed
}

// Connect to Wi-Fi
void setup_wifi() {
  delay(10);
  Serial.println();
  Serial.print("Connecting to ");
  Serial.println(WIFI_STA_NAME);

  WiFi.begin(WIFI_STA_NAME, WIFI_STA_PASS);

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());
}

// Callback function for handling MQTT messages
void callback(char* topic, byte* payload, unsigned int length) {
  String msg;
  for (unsigned int i = 0; i < length; i++) {
    msg += (char)payload[i];
  }

  Serial.print("Message arrived [");
  Serial.print(topic);
  Serial.print("] ");
  Serial.println(msg);

  // Handle different IR commands based on the message
  if (msg == "ON") {
    irsend.sendRaw(rawDataon, 229, 38);
  } else if (msg == "OFF") {
    irsend.sendRaw(rawDataoff, 229, 38);
  } else if (msg == "16") {
    irsend.sendRaw(rawData16, 229, 38);
  } else if (msg == "17") {
    irsend.sendRaw(rawData17, 229, 38);
  } else if (msg == "18") {
    irsend.sendRaw(rawData18, 229, 38);
  } else if (msg == "19") {
    irsend.sendRaw(rawData19, 229, 38);
  } else if (msg == "20") {
    irsend.sendRaw(rawData20, 229, 38);
  } else if (msg == "21") {
    irsend.sendRaw(rawData21, 229, 38);
  } else if (msg == "22") {
    irsend.sendRaw(rawData22, 229, 38);
  } else if (msg == "23") {
    irsend.sendRaw(rawData23, 229, 38);
  } else if (msg == "24") {
    irsend.sendRaw(rawData24, 229, 38);
  } else if (msg == "25") {
    irsend.sendRaw(rawData25, 229, 38);
  } else if (msg == "26") {
    irsend.sendRaw(rawData26, 229, 38);
  } else if (msg == "27") {
    irsend.sendRaw(rawData27, 229, 38);
  } else if (msg == "28") {
    irsend.sendRaw(rawData28, 229, 38);
  } else if (msg == "29") {
    irsend.sendRaw(rawData29, 229, 38);
  } else if (msg == "30") {
    irsend.sendRaw(rawData30, 229, 38);
  }
}

// Reconnect to MQTT broker if disconnected
void reconnect() {
  while (!client.connected()) {
    Serial.print("Attempting MQTT connection...");
    if (client.connect(MQTT_NAME)) {
      Serial.println("connected");
      client.subscribe("AirTest");
    } else {
      Serial.print("failed, rc=");
      Serial.print(client.state());
      Serial.println(" try again in 5 seconds");
      delay(5000);
    }
  }
}
